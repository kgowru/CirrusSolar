{"interaction":{"localVariables":[{"condition":"","dataType":"Number","name":"lowCellCount","description":"","id":0,"initialValue":"0"},{"condition":"","dataType":"Text","name":"panelOwner","description":"","id":1,"initialValue":"NULL"},{"condition":"","dataType":"Number","name":"lowPowerConstant","description":"","id":2,"initialValue":"0.1"},{"condition":"","dataType":"Number","name":"damagedCellConstant","description":"","id":3,"initialValue":"0.33"},{"condition":"","dataType":"Number","name":"capacityConstant","description":"","id":4,"initialValue":"0.9"},{"condition":"","dataType":"Text","name":"caseID","description":"","id":5,"initialValue":"NULL"},{"condition":"","dataType":"Text","name":"accountName","description":"","id":6,"initialValue":"\"Newton Farms\""},{"condition":"","dataType":"Text","name":"workOrderID","description":"","id":7,"initialValue":"NULL"},{"condition":"","dataType":"Text","name":"serviceApptID","description":"","id":8,"initialValue":"NULL"},{"condition":"","dataType":"Text","name":"lowPowerID","description":"","id":9,"initialValue":"NULL"}],"inputs":[],"states":[{"isDeployed":true,"name":"Always","id":0,"actions":[{"condition":"","description":"","id":0,"state":""}]},{"isDeployed":true,"name":"Panel Monitoring","isInitial":true,"id":1,"actions":[{"condition":"$Event.power_output__c = 0","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":2},"type":"catalog"}],"description":"If the power output is ever 0, transition to the No Power Generation state.","id":0,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.power_output__c < (lowPowerConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":3},"type":"catalog"}],"description":"If the power output falls below a preset threshold, transition to the Low Power Generation state.","id":1,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.active_cells__c < (damagedCellConstant*$Context.Total_Cells__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":4},"type":"catalog"}],"description":"If the active cells on the panel ever drops below a preset threshold, transition to the Possible Damaged Cells state.","id":2,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.power_output__c > (capacityConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":5},"type":"catalog"}],"description":"If the customer uses more than 95% of the power generated by the panels, transition to the Approaching Capacity state.","id":3,"state":"","when":{"name":"always","type":"catalog"}}]},{"isDeployed":true,"name":"No Power Generation","id":2,"actions":[{"condition":"$Event.power_output__c > 0","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"If the power output returns to normal, transition back to Panel Monitoring.","id":0,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.power_output__c = 0","eventSource":"Panel_Event__e","action":[{"inputFieldAssignments":[{"valueExpression":"\"Solar panel with serial number \" & $Event.serial_no__c & \" is not generating power.\"","field":"Subject","dataType":"Text"},{"valueExpression":"$Context.Account.Id","field":"AccountId","dataType":"Text"},{"valueExpression":"\"Solar panel with serial number \" & $Event.serial_no__c & \"is not generating power. IoT Cloud has automatically restarted the panel's inverter. No further action necessary.\"","field":"Description","dataType":"Text"},{"valueExpression":"\"On Hold\"","field":"Status","dataType":"Text"},{"valueExpression":"-10","field":"Service_Cost__c","dataType":"Number"},{"valueExpression":"\"IoT Cloud\"","field":"Origin","dataType":"Text"},{"valueExpression":"$Context.Contact.Id","field":"ContactId","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"noPowerResponse","label":"Create case to log inverter reset","id":0,"type":"syncOutput","sObjectApiName":"Case"}],"description":"Create a case to log that IoT Cloud reset the inverter.","id":1,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"","eventSource":"noPowerResponse","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"Transition to Panel Monitoring.","id":2,"state":"","when":{"name":"always","type":"catalog"}}]},{"isDeployed":true,"name":"Low Power Generation","id":3,"actions":[{"condition":"$Event.power_output__c > (lowPowerConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"If the power exceeds the low power threshold, transition back to Panel Monitoring.","id":0,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.power_output__c < (lowPowerConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"inputFieldAssignments":[{"valueExpression":"\"Solar panel with serial number \" & $Event.serial_no__c & \" is generating low power.\"","field":"Subject","dataType":"Text"},{"valueExpression":"$Context.Account.Id","field":"AccountId","dataType":"Text"},{"valueExpression":"\"Solar panel with serial number \" & $Event.serial_no__c & \"is generating lower-than-expected power. IoT Cloud has automatically sent the customer a knowledge article from Community Cloud to troubleshoot.\"","field":"Description","dataType":"Text"},{"valueExpression":"-10","field":"Service_Cost__c","dataType":"Number"},{"valueExpression":"\"IoT Cloud\"","field":"Origin","dataType":"Text"},{"valueExpression":"$Context.Contact.Id","field":"ContactId","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"lowPowerResponse","label":"Create low power case","id":0,"type":"syncOutput","sObjectApiName":"Case"}],"description":"Create a case to log the low power generation problem.","id":1,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"lowPowerResponse.Id != NULL","eventSource":"lowPowerResponse","action":[{"name":"assignVar","id":0,"params":{"$1":"lowPowerID","$2":"lowPowerResponse.Id"},"type":"catalog"},{"inputFieldAssignments":[{"valueExpression":"lowPowerID","field":"ParentId","dataType":"Text"},{"valueExpression":"0","field":"CommentCount","dataType":"Number"},{"valueExpression":"0","field":"LikeCount","dataType":"Number"},{"valueExpression":"\"0HnB00000008YPHKA2\"","field":"InsertedById","dataType":"Text"},{"valueExpression":"\"This is for Jeff \" & \"@[Jeff Manough]. Please check out this link to self-resolve low panel output: https://cirrusexplorer.force.com/customers/s/article/Low-Panel-Output\"","field":"Body","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"chatterResponse","label":"Create a Chatter post","id":1,"type":"syncOutput","sObjectApiName":"FeedItem"}],"description":"Assign the case ID to a variable and create a chatter post @mentioning the customer.","id":4,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"Transition back to the panel monitoring state when finished.","id":3,"state":"","when":{"name":"always","type":"catalog"}}]},{"isDeployed":true,"name":"Possible Damaged Cells","id":4,"actions":[{"condition":"$Event.active_cells__c > (damagedCellConstant*$Context.Total_Cells__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"If the active cell count returns to normal, transition back to Panel Monitoring.","id":0,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.active_cells__c < (damagedCellConstant*$Context.Total_Cells__c)","eventSource":"Panel_Event__e","action":[{"inputFieldAssignments":[{"valueExpression":"\"Solar panel with Serial Number \" & $Event.serial_no__c & \" is damaged.\"","field":"Subject","dataType":"Text"},{"valueExpression":"$Context.Account.Id","field":"AccountId","dataType":"Text"},{"valueExpression":"\"Solar panel with serial number \" & $Event.serial_no__c & \"is potentially damaged. IoT Cloud has dispatched a technician to resolve the issue.\"","field":"Description","dataType":"Text"},{"valueExpression":"\"IoT Cloud\"","field":"Origin","dataType":"Text"},{"valueExpression":"-10","field":"Service_Cost__c","dataType":"Number"},{"valueExpression":"$Context.Contact.Id","field":"ContactId","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"damagedResponse","label":"Create critical case for service team","id":0,"type":"syncOutput","sObjectApiName":"Case"}],"description":"Create a critical case for the service team to resolve the problem immediately.","id":1,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.Id != NULL","eventSource":"damagedResponse","action":[{"name":"assignVar","id":0,"params":{"$1":"caseID","$2":"$Event.Id"},"type":"catalog"},{"inputFieldAssignments":[{"valueExpression":"$Context.Account.Id","field":"AccountId","dataType":"Text"},{"valueExpression":"caseID","field":"CaseId","dataType":"Text"},{"valueExpression":"$Context.Id","field":"AssetId","dataType":"Text"},{"valueExpression":"\"Technician in route to diagnose panel issue.\"","field":"Description","dataType":"Text"},{"valueExpression":"\"Technician Request: Solar Panel \" & $Context.Serial_No__c","field":"Subject","dataType":"Text"},{"valueExpression":"$Context.Account.ShippingStreet","field":"Street","dataType":"Text"},{"valueExpression":"$Context.Account.ShippingCity","field":"City","dataType":"Text"},{"valueExpression":"$Context.Account.ShippingState","field":"State","dataType":"Text"},{"valueExpression":"\"Escalated\"","field":"Priority","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"workOrderResponse","label":"Create Work Order","id":1,"type":"syncOutput","sObjectApiName":"WorkOrder"}],"description":"Assign the caseID to a variable and create a work order.","id":2,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.Id != NULL","eventSource":"workOrderResponse","action":[{"name":"assignVar","id":0,"params":{"$1":"workOrderID","$2":"$Event.Id"},"type":"catalog"},{"inputFieldAssignments":[{"valueExpression":"null","field":"Address","dataType":"Text"},{"valueExpression":"DATETIMEVALUE(NOW())","field":"EarliestStartTime","dataType":"DateTime"},{"valueExpression":"DATETIMEVALUE(NOW() + 0.04167)","field":"DueDate","dataType":"DateTime"},{"valueExpression":"workOrderID","field":"ParentRecordId","dataType":"Text"},{"valueExpression":"DATETIMEVALUE(NOW())","field":"SchedStartTime","dataType":"DateTime"},{"valueExpression":"DATETIMEVALUE(NOW() + 0.04167)","field":"SchedEndTime","dataType":"DateTime"},{"valueExpression":"\"DISPATCHED\"","field":"Status","dataType":"Text"},{"valueExpression":"\"5565 Tesla Rd\"","field":"Street","dataType":"Text"},{"valueExpression":"\"Livermore\"","field":"City","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"saResponse","label":"Create a Service Appointment","id":1,"type":"syncOutput","sObjectApiName":"ServiceAppointment"}],"description":"Assign the workOrderID to a variable and then create a Service Appointment.","id":3,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.Id != NULL","eventSource":"saResponse","action":[{"name":"assignVar","id":2,"params":{"$1":"serviceApptID","$2":"$Event.Id"},"type":"catalog"},{"inputFieldAssignments":[{"valueExpression":"serviceApptID","field":"ServiceAppointmentId","dataType":"Text"},{"valueExpression":"\"0HnB00000008YPHKA2\"","field":"ServiceResourceId","dataType":"Text"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"resourceResponse","label":"Assign a Service Resource","id":1,"type":"syncOutput","sObjectApiName":"AssignedResource"}],"description":"Assign the Service Appointment id to a variable then associate a Service Resource.","id":4,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"","eventSource":"Panel_CDC__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"When all of the outputs are completed, transition back to the panel monitoring state.","id":5,"state":"","when":{"name":"always","type":"catalog"}}]},{"isDeployed":true,"name":"Approaching Capacity","id":5,"actions":[{"condition":"$Event.power_output__c < (capacityConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"name":"changeState","id":0,"params":{"$1":1},"type":"catalog"}],"description":"If the power usage falls below the upper bounds of the capacity threshold, transition back to Panel Monitoring.","id":0,"state":"","when":{"name":"always","type":"catalog"}},{"condition":"$Event.power_output__c > (capacityConstant*$Context.Output_Wattage__c)","eventSource":"Panel_Event__e","action":[{"inputFieldAssignments":[{"valueExpression":"\"Upsell \" & accountName & \" on more panels\"","field":"Name","dataType":"Text"},{"valueExpression":"\"Prospecting\"","field":"StageName","dataType":"Text"},{"valueExpression":"DATEVALUE(\"2017-07-23\")","field":"CloseDate","dataType":"Date"},{"valueExpression":"\"Pipeline\"","field":"ForecastCategory","dataType":"Text"},{"valueExpression":"\"001B000000WCgP3IAL\"","field":"AccountId","dataType":"Text"},{"valueExpression":"\"IoT Cloud has detected that \" & accountName & \" is using more than \" & TEXT(capacityConstant) & \"% of their purchased solar energy. Reach out to sell more panels.\"","field":"Description","dataType":"Text"},{"valueExpression":"\"Contact customer with value proposition.\"","field":"NextStep","dataType":"Text"},{"valueExpression":"5000","field":"Amount","dataType":"Number"},{"valueExpression":"50","field":"Probability","dataType":"Number"}],"name":"salesforceObjectCreate","isResponseIngested":true,"recordFilters":[],"responseEvent":"opptyResponse","label":"Create opportunity for sales team","id":0,"type":"syncOutput","sObjectApiName":"Opportunity"}],"description":"Create an opportunity for the sales team to sell more solar panels to the customer.","id":1,"state":"","when":{"name":"always","type":"catalog"}}]}]},"uiProperties":{},"formatVersion":"1.0","properties":{"timezone":"America/Los_Angeles"}}